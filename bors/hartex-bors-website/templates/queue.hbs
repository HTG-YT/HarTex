<!--
  ~ SPDX-License-Identifier: AGPL-3.0-only
  ~
  ~ This file is part of HarTex.
  ~
  ~ HarTex
  ~ Copyright (c) 2021-2023 HarTex Project Developers
  ~
  ~ HarTex is free software; you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as published by
  ~ the Free Software Foundation; either version 3 of the License, or
  ~ (at your option) any later version.
  ~
  ~ HarTex is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along
  ~ with HarTex. If not, see <https://www.gnu.org/licenses/>.
  -->

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Bors V2 Queue - {{repository}}</title>
    <style>
        * {
            font-family: sans-serif;
        }

        button {
            font-size: 15px;
        }

        h1 {
            font-size: 26px;
        }

        table {
            border-collapse: collapse;
        }

        td,
        th {
            border-bottom: 1px solid #DDD;
            padding: 5px 6px;
            font-size: 15px;
            text-align: left;
            vertical-align: baseline;
        }

        tr:nth-child(even) {
            background: #EEE;
        }

        .hide {
            display: none;
        }

        .cancelled .approve-cancelled {
            background-color: #B3B3B3;
        }

        .failure .approve-failure {
            background-color: #FF6666;
        }

        .success {
            background-color: #99FF99;
        }

        .pending .approve-pending {
            background-color: #FFCC66;
        }

        #rollup-popup {
            background: #C7E2FF;
            border: #00ACF7 3px double;
            border-radius: 5px;
            padding: 0 1em;
            width: 75%;
        }
    </style>
</head>

<body>
    <h1>Bors V2 Queue - {{repository}}</h1>
    <p>
        <button type="button" id="expand-rollup">Create a Rollup</button>
    </p>

    <div id="rollup-popup" class="hide">
        <p>This will create a new pull request consisting of (a number here) existing pull requests.</p>
        <p>A rollup is especally useful for shortening the queue.</p>
        <p>
            <button type="button" id="confirm-rollup">Rollup</button>
            â€”
            <button type="button" id="cancel-rollup">Cancel</button>
        </p>
    </div>

    <p>
        Total Pull Requests: {{total}}
    </p>

    <table id="queue">
        <thead>
            <th><input type="checkbox"></th>
            <th>#</th>
            <th>Status</th>
            <th>Status (Try)</th>
            <th>Title</th>
            <th>Head ref</th>
            <th>Assignee</th>
            <th>Approved by</th>
            <th>Rollup</th>
        </thead>

        <tbody>
            {{#each pull_requests}}
            <tr>
                <td><input type="checkbox"></td>
                <td><a href="{{this.url}}">{{this.number}}</a></td>
                <td class="approve-{{this.approve_status}}">{{this.approve_status}}</td>
                <td class="{{this.try_status}}">{{this.try_status}}</td>
                <td>{{this.title}}</td>
                <td>{{this.head_ref}}</td>
                <td>{{this.assignee}}</td>
                <td>{{this.approved_by}}</td>
                <td></td>
            </tr>
            {{/each}}
        </tbody>
    </table>

    <script>
        document.getElementById('expand-rollup').onclick = function () {
            document.getElementById('rollup-popup').className = '';
        }

        document.getElementById('cancel-rollup').onclick = function () {
            document.getElementById('rollup-popup').className = 'hide';
        }

        document.querySelector('#queue thead input[type=checkbox]').onclick = function(ev) {
            ev.stopPropagation();

            let elements = document.querySelectorAll('#queue tbody input[type=checkbox]');
            for (let i = 0; i < elements.length; i++)
                elements[i].checked = this.checked;
        }
    </script>
</body>

</html>
